<!DOCTYPE html>
<html>
<head>
  <title>Admin Login</title>
  <style>
    body { font-family: Arial, sans-serif; text-align:center; padding-top:100px; }
    form { display:inline-block; padding:20px; border:1px solid #ccc; border-radius:8px; }
    input { display:block; margin:10px auto; padding:8px; width:200px; }
    button { padding:8px 14px; background:#4CAF50; color:white; border:none; border-radius:4px; cursor:pointer; }
    button:hover { background:#45a049; }
  </style>
</head>
<body>
  <h2>Admin Login</h2>
  <form onsubmit="login(event)">
    <input type="text" id="username" placeholder="Username" required>
    <input type="password" id="password" placeholder="Password" required>
    <button type="submit">Login</button>
  </form>

  <script>
    const apiBase = "http://127.0.0.1:8000";

    async function login(event) {
      event.preventDefault();

      const username = document.getElementById("username").value.trim();
      const password = document.getElementById("password").value.trim();

      try {
        const response = await fetch(`${apiBase}/admin/login`, {
          method: "POST",
          headers: { "Content-Type": "application/x-www-form-urlencoded" },
          body: new URLSearchParams({ "username": username, "password": password })
        });

        const data = await response.json();

        if (!response.ok) {
          alert("‚ùå Login failed: " + (data.detail || "Invalid credentials"));
          return;
        }

        // ‚úÖ Save token
        localStorage.setItem("token", data.access_token);
        alert("‚úÖ Login successful!");

        // üîπ Bulk delete users if requested
        const userIds = JSON.parse(localStorage.getItem("deleteUserIds") || "[]");
        if (userIds.length > 0) {
          for (let id of userIds) {
            try {
              const delRes = await fetch(`${apiBase}/duser/${id}`, {
                method: "DELETE",
                headers: { "Authorization": "Bearer " + data.access_token }
              });
              const delData = await delRes.json();
              console.log(`Deleted user ${id}:`, delData);
            } catch (err) {
              console.error(`Error deleting user ${id}:`, err);
            }
          }
          alert(`‚úÖ Deleted ${userIds.length} user(s) successfully`);
          localStorage.removeItem("deleteUserIds"); // clear after deletion
        }

        // Redirect back to dashboard
        window.location.href = "index.html";

      } catch (err) {
        alert("‚ö†Ô∏è Login failed: " + err.message);
      }
    }
  </script>
</body>
</html>
